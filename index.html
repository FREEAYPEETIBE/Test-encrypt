<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Esparagoza Dental Hub</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<style>

/* ============================
   GLOBAL COLORS & VARIABLES
============================ */
:root{
  --brand:#0b6bcb;
  --accent:#2ea0ff;
  --success:#00b386;
  --danger:#d9534f;
  --card:#ffffff;
  --line:#e6eef7;
  --muted:#7787a2;
}

*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

/* ============================
   BODY BACKGROUND
============================ */
body{
  background:#f3f8ff;
  color:var(--brand);
  overflow-x:hidden;
}

/* ============================
   FRONT PAGE
============================ */
#frontPage{
  position:fixed;
  inset:0;
  background-image:url('https://i.imgur.com/qKJc5zC.png');
  background-size:cover;
  background-position:center;
  display:flex;
  justify-content:center;
  align-items:center;
  transition:0.6s ease;
  z-index:40;
}
#frontPage.fadeOut{
  opacity:0;
  pointer-events:none;
  transform:scale(1.03);
}

.front-overlay{
  position:absolute;
  inset:0;
  background:rgba(0,0,0,0.25);
  backdrop-filter:blur(1px);
}

.front-inner{
  position:relative;
  z-index:2;
  width:92%;
  max-width:1100px;
  padding-top:140px;
  text-align:center;
  color:white;
}
.logo-big{
  width:360px;
  margin:auto;
}
.welcome{
  font-size:32px;
  font-weight:700;
  margin-top:10px;
}
.meta-row{
  margin-top:10px;
  display:flex;
  justify-content:center;
  gap:12px;
  flex-wrap:wrap;
}
.pill{
  padding:8px 14px;
  border-radius:100px;
  background:rgba(255,255,255,0.2);
  font-weight:600;
}
.status-in{background:#00b386;color:white}
.status-out{background:#e57373;color:white}

.cta-btn{
  margin-top:16px;
  padding:14px 26px;
  border:none;
  border-radius:10px;
  background:linear-gradient(90deg,var(--accent),var(--brand));
  color:white;
  font-weight:700;
  font-size:17px;
  cursor:pointer;
}

/* ============================
   BOOKING PAGE CONTAINER
============================ */
#mainContainer{
  padding:20px;
  max-width:960px;
  margin:auto;
  margin-top:20px;
  opacity:0;
  pointer-events:none;
  transition:0.4s;
}
#mainContainer.show{
  opacity:1;
  pointer-events:auto;
}

/* CLEAN MEDICAL-FORM CARD LAYOUT */
.form-card{
  background:white;
  border-radius:14px;
  box-shadow:0 8px 22px rgba(0,0,0,0.08);
  padding:22px 26px;
  margin-bottom:32px;
}

/* Section Titles */
.section-title{
  font-size:20px;
  font-weight:600;
  margin-bottom:10px;
  color:var(--brand);
  border-left:4px solid var(--brand);
  padding-left:10px;
}

/* LABELS / INPUTS */
label{
  font-size:14px;
  font-weight:600;
  margin-bottom:4px;
  display:block;
}
input,select,textarea{
  width:100%;
  padding:10px 12px;
  font-size:15px;
  border:1px solid var(--line);
  border-radius:10px;
  background:#fff;
  outline:none;
}

/* Submit Button */
.btn-primary{
  width:100%;
  padding:14px;
  background:linear-gradient(90deg,var(--accent),var(--brand));
  border:none;
  color:white;
  border-radius:10px;
  font-weight:700;
  cursor:pointer;
}

/* Divider Line */
.divider{
  height:1px;
  width:100%;
  background:var(--line);
  margin:18px 0;
}

/* Calendar Grid */
.weeknames{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  text-align:center;
  font-size:12px;
  color:#3b6b90;
  margin-bottom:6px;
}

.cal-grid{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:6px;
}

.day-tile{
  width:100%;
  aspect-ratio:1/1.08;
  border-radius:10px;
  background:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight:600;
  color:var(--brand);
  cursor:pointer;
  box-shadow:0 1px 3px rgba(0,0,0,0.06);
}
.day-tile:hover{transform:scale(1.05)}
.day-tile.closed{
  background:#eef2f8;
  color:#9aa5bb;
  cursor:not-allowed;
}
.day-tile.today{
  border:2px solid var(--brand);
}

/* Time Slot Buttons */
.slot-btn{
  padding:10px;
  border-radius:10px;
  border:none;
  background:#edf5ff;
  font-weight:600;
  cursor:pointer;
}
.slot-btn.selected{
  background:var(--brand);
  color:white;
}
.slot-btn.booked{
  background:#ccc;
  color:#666;
  cursor:not-allowed;
}

/* Signature Pad */
.sig-wrap{
  background:#f9fbff;
  border:1px dashed #bcd0e7;
  padding:12px;
  border-radius:10px;
}
canvas{
  width:100%;
  height:180px;
  border-radius:10px;
  background:white;
  display:block;
}

/* Prevent mobile scroll during signature */
.noscroll{
  overflow:hidden !important;
}

/* RESPONSIVE */
@media(max-width:600px){
  .form-card{padding:18px}
  .section-title{font-size:18px}
  input,select,textarea{font-size:14px}
  .day-tile{font-size:12px}
}

</style>
</head>

<body>
<!-- FRONT PAGE -->
<section id="frontPage">
  <div class="front-overlay"></div>

  <div class="front-inner">
    <img src="https://i.imgur.com/cUQHJFZ.png" class="logo-big">
    <div class="welcome">Welcome to Dental Hub Davao</div>

    <div class="meta-row">
      <div class="pill" id="todayDate">Loading…</div>
      <div class="pill status-out" id="dentistStatus">Dentist: OUT</div>
    </div>

    <button class="cta-btn" id="toBookingBtn">Make an Appointment</button>
  </div>
</section>

<div id="mainContainer">

  <!-- =========================
       PART 2 — Booking Page
       (Header image + Medical-form layout)
       ========================= -->
  <main id="bookingPage" class="form-card" aria-hidden="true">

    <!-- HEADER IMAGE: full-width, smaller height, semi-transparent overlay -->
    <div style="
      position:relative;
      width:100%;
      height:180px;
      background-image:url('https://i.imgur.com/V7CJsPy.png');
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      margin:0 0 18px 0;
      box-shadow:0 3px 10px rgba(0,0,0,0.12);
      overflow:hidden;
    ">
      <div style="position:absolute;inset:0;background:rgba(0,0,0,0.22);backdrop-filter:blur(0.8px)"></div>
    </div>

    <!-- Page title -->
    <div style="text-align:center;margin-bottom:14px">
      <h2 style="margin:0;color:var(--brand);font-size:22px;font-weight:700">Dental Appointment Booking & Consent</h2>
      <div style="color:var(--muted);font-size:13px;margin-top:6px">Please select appointment date & time, complete the medical form and sign the consent.</div>
    </div>

    <!-- ---------------------------
         Calendar Section
         --------------------------- -->
    <section style="margin-bottom:18px">
      <div class="section-title">Select Date</div>

      <div style="display:flex;gap:8px;align-items:center;margin:12px 0 8px;">
        <button id="prevMonth" class="btn-primary" style="width:48px;max-width:48px;padding:8px;">&#10094;</button>
        <div style="flex:1;text-align:center;font-weight:700;color:var(--brand)" id="monthTitle">Month</div>
        <button id="nextMonth" class="btn-primary" style="width:48px;max-width:48px;padding:8px;">&#10095;</button>
      </div>

      <div class="weeknames">
        <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
      </div>

      <div class="cal-grid" id="calGrid" aria-label="calendar"></div>
      <div style="text-align:center;color:var(--muted);font-size:13px;margin-top:8px">Closed or fully booked dates are grayed out.</div>
    </section>

    <!-- ---------------------------
         Time Slot Section
         --------------------------- -->
    <section style="margin-bottom:14px">
      <div class="section-title">Select Time</div>
      <div id="slotsGrid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(120px,1fr));gap:8px;margin-top:10px"></div>
    </section>

    <div class="divider"></div>

    <!-- ---------------------------
         Medical Form: Patient Info
         --------------------------- -->
    <form id="bookingForm" autocomplete="off">
      <div class="section-title" style="margin-bottom:12px">Patient Information</div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
        <div>
          <label for="firstName">First Name</label>
          <input id="firstName" type="text" required>
        </div>
        <div>
          <label for="lastName">Last Name</label>
          <input id="lastName" type="text" required>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:10px">
        <div>
          <label for="age">Age</label>
          <input id="age" type="number" min="0">
        </div>
        <div>
          <label for="dob">Date of Birth</label>
          <input id="dob" type="date">
        </div>
        <div>
          <label for="isMinor">Minor?</label>
          <select id="isMinor"><option value="no">No</option><option value="yes">Yes</option></select>
        </div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px">
        <div>
          <label for="phone">Phone Number</label>
          <input id="phone" type="text" required>
        </div>
        <div>
          <label for="email">Email</label>
          <input id="email" type="email" required>
        </div>
      </div>

      <div style="margin-top:10px">
        <label for="address">Address</label>
        <input id="address" type="text">
      </div>

      <div style="display:flex;gap:10px;margin-top:12px">
        <div style="flex:1">
          <label for="date">Selected Date</label>
          <input id="date" type="text" readonly required>
        </div>
        <div style="flex:1">
          <label for="time">Selected Time</label>
          <input id="time" type="text" readonly required>
        </div>
      </div>

      <div class="divider"></div>

      <!-- ---------------------------
           Procedure Details
           --------------------------- -->
      <div class="section-title" style="margin-bottom:12px">Dental Procedure Details</div>

      <div style="display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px">
        <label><input type="checkbox" class="proc" value="Tooth Extraction"> Tooth Extraction</label>
        <label><input type="checkbox" class="proc" value="Grafting"> Grafting</label>
        <label><input type="checkbox" class="proc" value="Restoration"> Restoration</label>
        <label><input type="checkbox" class="proc" value="Cosmetic Dentistry"> Cosmetic Dentistry</label>
        <label><input type="checkbox" class="proc" value="Implants"> Implants</label>
        <label><input type="checkbox" class="proc" value="Prosthetics"> Prosthetics</label>
        <label><input type="checkbox" class="proc" value="Oral Sedation"> Oral Sedation</label>
        <label><input type="checkbox" class="proc" value="Root Planing"> Root Planing</label>
      </div>

      <div style="margin-top:10px">
        <label for="allergies">Any Allergies?</label>
        <textarea id="allergies" rows="2" placeholder="Describe allergies if any"></textarea>
      </div>

      <div style="margin-top:10px">
        <label for="medications">Current Medications</label>
        <textarea id="medications" rows="2" placeholder="List current medications"></textarea>
      </div>

      <div style="margin-top:10px">
        <label for="conditions">Medical Conditions</label>
        <textarea id="conditions" rows="2" placeholder="e.g., diabetes, cardiac conditions"></textarea>
      </div>

      <div class="divider"></div>

      <!-- ---------------------------
           Acknowledgement & Waiver
           --------------------------- -->
      <div class="section-title" style="margin-bottom:10px">Acknowledgement & Waiver</div>
      <div style="display:flex;flex-direction:column;gap:8px;margin-top:8px">
        <label><input type="checkbox" id="ack1"> I allow and authorize the clinic to perform the procedure and understand the nature and risks.</label>
        <label><input type="checkbox" id="ack2"> I allow the doctor to administer anesthesia and understand possible side effects.</label>
        <label><input type="checkbox" id="ack3"> I understand the post-treatment instructions and agree to follow them.</label>
        <label><input type="checkbox" id="ack4"> I acknowledge that all information provided is true and accurate.</label>
      </div>

      <div class="divider"></div>

      <!-- ---------------------------
           Signature Pad
           --------------------------- -->
      <div class="section-title" style="margin-bottom:10px">Signature</div>
      <div class="sig-wrap" style="margin-bottom:10px">
        <canvas id="sigCanvas"></canvas>
        <div style="display:flex;gap:8px;align-items:center;margin-top:10px">
          <button type="button" id="clearSig" class="btn-primary" style="background:#6c757d;width:auto;padding:8px 12px">Clear</button>
          <button type="button" id="saveSig" class="btn-primary" style="width:auto;padding:8px 12px">Save Signature</button>
          <div style="flex:1"></div>
          <div style="min-width:160px">
            <label for="signedDate">Signed Date</label>
            <input id="signedDate" type="date">
          </div>
        </div>
      </div>

      <!-- ---------------------------
           Submit
           --------------------------- -->
      <div style="margin-top:10px">
        <button id="submitBookingBtn" class="btn-primary" type="button">Submit Booking</button>
      </div>

    </form>

    <!-- Toast + Modal -->
    <div id="toastWrap" class="toast-wrap"></div>
    <div class="modal-overlay" id="modalOverlay" aria-hidden="true">
      <div class="modal-content">
        <button class="close-btn" id="closeModal">&times;</button>
        <div id="sectionContent"></div>
      </div>
    </div>

  </main>

  <!-- keep mainContainer open here — Part 3 will include JS and closing tags -->

  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>

<script>
// ======================================
//  FIREBASE CONFIG
// ======================================
const firebaseConfig = {
  apiKey: "AIzaSyD3cX...",
  authDomain: "your-app.firebaseapp.com",
  databaseURL: "https://your-app.firebaseio.com",
  projectId: "your-app",
  storageBucket: "your-app.appspot.com",
  messagingSenderId: "000000",
  appId: "1:000000:web:000000"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ======================================
//  FRONT PAGE → BOOKING PAGE TRANSITION
// ======================================
document.getElementById("toBookingBtn").onclick = () => {
  document.getElementById("frontPage").classList.add("fadeOut");
  setTimeout(() => {
    document.getElementById("mainContainer").classList.add("show");
  }, 400);
};

// ======================================
//  TODAY DATE + DENTIST STATUS
// ======================================
function updateToday() {
  let d = new Date();
  let opt = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
  document.getElementById("todayDate").textContent = d.toLocaleDateString("en-US", opt);
}
updateToday();

function checkDentistStatus() {
  let h = new Date().getHours();
  document.getElementById("dentistStatus").textContent =
    (h >= 9 && h <= 17) ? "Dentist: IN" : "Dentist: OUT";
  document.getElementById("dentistStatus").className =
    (h >= 9 && h <= 17) ? "pill status-in" : "pill status-out";
}
checkDentistStatus();
setInterval(checkDentistStatus, 60000);

// ======================================
//  CALENDAR + TIME SLOTS
// ======================================
const calGrid = document.getElementById("calGrid");
let current = new Date();
let selDate = "";
let selTime = "";

function renderCalendar() {
  calGrid.innerHTML = "";
  let year = current.getFullYear();
  let month = current.getMonth();

  document.getElementById("monthTitle").textContent =
    current.toLocaleString("default", { month: "long" }) + " " + year;

  let firstDay = new Date(year, month, 1).getDay();
  let daysInMonth = new Date(year, month + 1, 0).getDate();

  for (let i = 0; i < firstDay; i++) {
    let empty = document.createElement("div");
    empty.classList.add("day-tile", "closed");
    empty.style.visibility = "hidden";
    calGrid.appendChild(empty);
  }

  for (let day = 1; day <= daysInMonth; day++) {
    let tile = document.createElement("div");
    tile.classList.add("day-tile");
    tile.textContent = day;

    let fullDate = `${year}-${(month+1).toString().padStart(2,"0")}-${day
      .toString().padStart(2,"0")}`;

    if (new Date(fullDate) < new Date().setHours(0,0,0,0)) {
      tile.classList.add("closed");
    }

    tile.onclick = () => {
      if (tile.classList.contains("closed")) return;
      selDate = fullDate;
      document.getElementById("date").value = selDate;
      loadTimeSlots(selDate);
    };

    calGrid.appendChild(tile);
  }
}
renderCalendar();

document.getElementById("nextMonth").onclick = () => {
  current.setMonth(current.getMonth()+1);
  renderCalendar();
};
document.getElementById("prevMonth").onclick = () => {
  current.setMonth(current.getMonth()-1);
  renderCalendar();
};

function loadTimeSlots(date) {
  const slotsGrid = document.getElementById("slotsGrid");
  slotsGrid.innerHTML = "";

  const times = [
    "09:00 AM","09:30 AM","10:00 AM","10:30 AM",
    "11:00 AM","11:30 AM","01:00 PM","01:30 PM",
    "02:00 PM","02:30 PM","03:00 PM","03:30 PM"
  ];

  db.ref("bookings/" + date).once("value", snap => {
    let booked = snap.val() || {};

    times.forEach(t => {
      let btn = document.createElement("button");
      btn.textContent = t;
      btn.className = "slot-btn";

      if (booked[t]) {
        btn.classList.add("booked");
        btn.disabled = true;
      }

      btn.onclick = () => {
        selTime = t;
        document.getElementById("time").value = selTime;
        [...slotsGrid.children].forEach(x => x.classList.remove("selected"));
        btn.classList.add("selected");
      };

      slotsGrid.appendChild(btn);
    });
  });
}

// ======================================
//  SIGNATURE PAD + SCROLL LOCK
// ======================================
const canvas = document.getElementById("sigCanvas");
const ctx = canvas.getContext("2d");
let drawing = false;

function resizeCanvas() {
  canvas.width = canvas.offsetWidth;
  canvas.height = canvas.offsetHeight;
}
resizeCanvas();
window.addEventListener("resize", resizeCanvas);

canvas.addEventListener("mousedown", e => {
  drawing = true;
  ctx.moveTo(e.offsetX, e.offsetY);
});
canvas.addEventListener("mouseup", () => drawing = false);
canvas.addEventListener("mousemove", e => {
  if (!drawing) return;
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";
  ctx.lineTo(e.offsetX, e.offsetY);
  ctx.stroke();
});

// TOUCH (with scroll lock)
canvas.addEventListener("touchstart", e => {
  e.preventDefault();
  document.body.classList.add("noscroll");
  drawing = true;

  let rect = canvas.getBoundingClientRect();
  let t = e.touches[0];
  ctx.moveTo(t.clientX - rect.left, t.clientY - rect.top);
}, {passive:false});

canvas.addEventListener("touchend", () => {
  drawing = false;
  document.body.classList.remove("noscroll");
}, {passive:false});

canvas.addEventListener("touchmove", e => {
  e.preventDefault();
  if (!drawing) return;
  let rect = canvas.getBoundingClientRect();
  let t = e.touches[0];
  ctx.lineWidth = 2;
  ctx.lineCap = "round";
  ctx.strokeStyle = "#000";
  ctx.lineTo(t.clientX - rect.left, t.clientY - rect.top);
  ctx.stroke();
}, {passive:false});

// CLEAR + SAVE SIG
document.getElementById("clearSig").onclick = () => {
  ctx.clearRect(0,0,canvas.width,canvas.height);
};

let signatureData = "";
document.getElementById("saveSig").onclick = () => {
  signatureData = canvas.toDataURL();
  alert("Signature saved.");
};

// ======================================
//  SUBMIT BOOKING
// ======================================
document.getElementById("submitBookingBtn").onclick = () => {
  if (!selDate || !selTime) {
    alert("Please select date and time.");
    return;
  }
  if (!signatureData) {
    alert("Please draw and save your signature.");
    return;
  }

  // Collect all form data
  const formData = {
    firstName: firstName.value,
    lastName: lastName.value,
    age: age.value,
    dob: dob.value,
    isMinor: isMinor.value,
    phone: phone.value,
    email: email.value,
    address: address.value,
    date: selDate,
    time: selTime,
    procedures: [...document.querySelectorAll(".proc:checked")].map(p=>p.value),
    allergies: allergies.value,
    medications: medications.value,
    conditions: conditions.value,
    ack1: ack1.checked,
    ack2: ack2.checked,
    ack3: ack3.checked,
    ack4: ack4.checked,
    signature: signatureData,
    signedDate: signedDate.value
  };

  // SAVE TO FIREBASE
  db.ref("bookings/" + selDate + "/" + selTime).set(formData)
    .then(() => sendEmail(formData))
    .catch(err => alert("Error saving booking: " + err));
};

// ======================================
//  EMAILJS SEND
// ======================================
emailjs.init("YOUR_EMAILJS_PUBLIC_KEY");

function sendEmail(data) {
  emailjs.send("YOUR_SERVICE_ID", "YOUR_TEMPLATE_ID", {
    name: data.firstName + " " + data.lastName,
    email: data.email,
    phone: data.phone,
    date: data.date,
    time: data.time,
    procedures: data.procedures.join(", "),
    allergies: data.allergies,
    medications: data.medications,
    conditions: data.conditions,
    signature: data.signature
  })
  .then(() => {
    alert("Booking submitted successfully!");
    location.reload();
  })
  .catch(err => alert("Email sending failed: " + err));
}
</script>

</div> <!-- end mainContainer -->
</body>
</html>
